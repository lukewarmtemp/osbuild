{
  "version": "2",
  "pipelines": [
    {
      "runner": "org.osbuild.fedora38",
      "name": "build",
      "source-epoch": 1659397331
    },
    {
      "name": "image",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.ostree",
          "items": {
            "bf28f852e934b0c0b9eee232a58970e96adb3e691299b02376f8719530e03fb3": {
              "remote": {
                "url": "https://ostree.fedoraproject.org",
                "contenturl": "mirrorlist=https://ostree.fedoraproject.org/mirrorlist"
              }
            }   
          }
        },
        {
          "type": "org.osbuild.truncate",
          "options": {
            "filename": "disk.img",
            "size": "10737418240"
          }
        },
        {
          "type": "org.osbuild.sfdisk",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img"
              }
            }
          },
          "options": {
            "uuid": "D209C89E-EA5E-4FBD-B161-B461CCE297E0",
            "label": "gpt",
            "partitions": [
              {
                "start": 2048,
                "size": 2048,
                "type": "21686148-6449-6E6F-744E-656564454649",
                "bootable": true,
                "uuid": "FAC7F1FB-3E8D-4137-A512-961DE09A5549"
              },
              {
                "start": 4096,
                "size": 204800,
                "type": "C12A7328-F81F-11D2-BA4B-00A0C93EC93B",
                "uuid": "68B2905B-DF3E-4FB3-80FA-49D1E773AA33"
              },
              {
                "start": 208896,
                "size": 204800,
                "type": "0FC63DAF-8483-4772-8E79-3D69D8477DE4",
                "uuid": "61B2905B-DF3E-4FB3-80FA-49D1E773AA32"
              },
              {
                "start": 413696,
                "size": 20555776,
                "type": "0FC63DAF-8483-4772-8E79-3D69D8477DE4",
                "uuid": "CA7D7CCB-63ED-4C53-861C-1742536059CC"
              }
            ]
          }
        },
        {
          "type": "org.osbuild.mkfs.fat",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 4096,
                "size": 204800,
                "lock": true
              }
            }
          },
          "options": {
            "label": "ESP",
            "volid": "7B7795E7"
          }
        },
        {
          "type": "org.osbuild.mkfs.ext4",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 208896,
                "size": 204800,
                "lock": true
              }
            }
          },
          "options": {
            "uuid": "156f0420-627b-4151-ae6f-fda298097515",
            "label": "boot"
          }
        },
        {
          "type": "org.osbuild.luks2.format",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 413696,
                "size": 20555776,
                "lock": true
              }
            }
          },
          "options": {
            "passphrase": "osbuild",
            "uuid": "aedd1eef-f24e-425e-a9f3-bb5a1c996a95",
            "label": "luks",
            "pbkdf": {
              "method": "argon2i",
              "memory": 32,
              "parallelism": 1,
              "iterations": 4
            }
          }
        },
        {
          "type": "org.osbuild.lvm2.create",
          "devices": {
            "luks": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 413696,
                "size": 20555776
              }
            },
            "device": {
              "type": "org.osbuild.luks2",
              "parent": "luks",
              "options": {
                "passphrase": "osbuild"
              }
            }
          },
          "options": {
            "volumes": [
              {
                "name": "root",
                "extents": "100%FREE"
              }
            ]
          }
        },
        {
          "type": "org.osbuild.mkfs.xfs",
          "devices": {
            "luks": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 413696,
                "size": 20555776
              }
            },
            "lvm": {
              "type": "org.osbuild.luks2",
              "parent": "luks",
              "options": {
                "passphrase": "osbuild"
              }
            },
            "device": {
              "type": "org.osbuild.lvm2.lv",
              "parent": "lvm",
              "options": {
                "volume": "root"
              }
            }
          },
          "options": {
            "uuid": "76a22bf4-f153-4541-b6c7-0332c0dfaeac",
            "label": "root"
          }
        },
        {
          "type": "org.osbuild.grub2.inst",
          "options": {
            "platform": "i386-pc",
            "filename": "disk.img",
            "location": 2048,
            "core": {
              "type": "mkimage",
              "partlabel": "gpt",
              "filesystem": "ext4"
            },
            "prefix": {
              "type": "partition",
              "partlabel": "gpt",
              "number": 2,
              "path": "/grub2"
            }
          }
        },
        {
          "type": "org.osbuild.lvm2.metadata",
          "devices": {
            "luks": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 413696,
                "size": 20555776
              }
            },
            "device": {
              "type": "org.osbuild.luks2",
              "parent": "luks",
              "options": {
                "passphrase": "osbuild"
              }
            }
          },
          "options": {
            "vg_name": "osbuild",
            "creation_host": "osbuild",
            "description": "Built with osbuild"
          }
        }
      ]
    },
    {
      "name": "container-deploy",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.ostree.container-deploy"
        }
      ]
    },
    {
      "name": "qcow2",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.qemu",
          "inputs": {
            "image": {
              "type": "org.osbuild.files",
              "origin": "org.osbuild.pipeline",
              "references": {
                "name:image": {
                  "file": "disk.img"
                }
              }
            }
          },
          "options": {
            "filename": "disk.qcow2",
            "format": {
              "type": "qcow2",
              "compat": "1.1"
            }
          }
        }
      ]
    }
  ]
}
